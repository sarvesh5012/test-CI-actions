name: Dockerfile Lint

on:
  push:
    branches:
      - main  # Run on push to main
  pull_request:
    branches:
      - main  # Run on pull requests to main

jobs:
  lint-dockerfiles:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install hadolint
      run: |
        sudo wget -O /bin/hadolint https://github.com/hadolint/hadolint/releases/download/v2.10.0/hadolint-Linux-x86_64
        sudo chmod +x /bin/hadolint

    - name: Lint Dockerfiles
      run: |
        #!/usr/bin/env sh
        set -eu

        DOCKERFILE_DIR=${DOCKERFILE_DIR:-"."}

        echo "Linting dockerfiles in: $DOCKERFILE_DIR"
        find $DOCKERFILE_DIR -name "*Dockerfile*" | xargs hadolint

        echo "Dockerfiles are valid!"
